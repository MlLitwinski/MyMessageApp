import{A as Tt,B as T,C as kt,D as g,E as I,F as U,G as Ft,H as Rt,I as Nt,J as Dt,K as B,M as jt,N as Vt,O as Ut,P as Bt,Q as zt,R as Ht,S as Gt,T as Kt,U as $t,V as qt,W as Wt,X as z,a as gt,b as K,c as vt,d as _t,e as yt,f as Ct,g as Pt,h as O,i as xt,j as bt,k as St,m as D,o as It,p as Mt,q as wt,u as At,v as Et,w as Lt,x as Ot,y as j,z as V}from"./chunk-LYWF3C2O.js";import{Ab as d,Bb as N,Cb as lt,D as tt,Fa as rt,Fb as dt,Ha as R,Ka as p,La as f,Ma as nt,Oa as st,Qa as at,Sa as mt,Ta as pt,W as et,Z as y,_ as w,ab as _,ac as ut,ca as C,cb as l,da as it,g as X,ia as P,ic as ft,j as Y,ja as A,jc as E,la as ot,lb as s,lc as ht,mb as a,nb as h,o as Z,p as J,pb as M,qa as x,ra as b,rb as S,s as Q,sb as u,zb as ct}from"./chunk-J2EOURVG.js";var me="@",pe=(()=>{let t=class t{constructor(e,i,n,m,c){this.doc=e,this.delegate=i,this.zone=n,this.animationType=m,this.moduleImpl=c,this._rendererFactoryPromise=null,this.scheduler=it(st,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){return(this.moduleImpl??import("./chunk-HNB5VLJN.js")).catch(i=>{throw new et(5300,!1)}).then(({\u0275createEngine:i,\u0275AnimationRendererFactory:n})=>{this._engine=i(this.animationType,this.doc,this.scheduler);let m=new n(this.delegate,this._engine,this.zone);return this.delegate=m,m})}createRenderer(e,i){let n=this.delegate.createRenderer(e,i);if(n.\u0275type===0)return n;typeof n.throwOnSyntheticProps=="boolean"&&(n.throwOnSyntheticProps=!1);let m=new $(n);return i?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(c=>{let L=c.createRenderer(e,i);m.use(L)}).catch(c=>{m.use(n)}),m}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};t.\u0275fac=function(i){nt()},t.\u0275prov=y({token:t,factory:t.\u0275fac});let o=t;return o})(),$=class{constructor(t){this.delegate=t,this.replay=[],this.\u0275type=1}use(t){if(this.delegate=t,this.replay!==null){for(let r of this.replay)r(t);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(t,r){return this.delegate.createElement(t,r)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}get destroyNode(){return this.delegate.destroyNode}appendChild(t,r){this.delegate.appendChild(t,r)}insertBefore(t,r,e,i){this.delegate.insertBefore(t,r,e,i)}removeChild(t,r,e){this.delegate.removeChild(t,r,e)}selectRootElement(t,r){return this.delegate.selectRootElement(t,r)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,r,e,i){this.delegate.setAttribute(t,r,e,i)}removeAttribute(t,r,e){this.delegate.removeAttribute(t,r,e)}addClass(t,r){this.delegate.addClass(t,r)}removeClass(t,r){this.delegate.removeClass(t,r)}setStyle(t,r,e,i){this.delegate.setStyle(t,r,e,i)}removeStyle(t,r,e){this.delegate.removeStyle(t,r,e)}setProperty(t,r,e){this.shouldReplay(r)&&this.replay.push(i=>i.setProperty(t,r,e)),this.delegate.setProperty(t,r,e)}setValue(t,r){this.delegate.setValue(t,r)}listen(t,r,e){return this.shouldReplay(r)&&this.replay.push(i=>i.listen(t,r,e)),this.delegate.listen(t,r,e)}shouldReplay(t){return this.replay!==null&&t.startsWith(me)}};function Xt(o="animations"){return mt("NgAsyncAnimations"),ot([{provide:at,useFactory:(t,r,e)=>new pe(t,r,e,o),deps:[ut,_t,pt]},{provide:rt,useValue:o==="noop"?"NoopAnimations":"BrowserAnimations"}])}var H=(()=>{let t=class t{constructor(e,i){this.http=e,this.router=i,this.posts=[],this.postsUpdate=new Y,this.BACKEND_URL=kt.apiUrl+"/posts/"}getPosts(e,i){let n=`?pagesize=${e}&page=${i}`;this.http.get(this.BACKEND_URL+n).pipe(Q(m=>({posts:m.posts.map(c=>({title:c.title,content:c.content,id:c._id,imagePath:c.imagePath,creator:c.creator})),mexPosts:m.maxPosts}))).subscribe(m=>{m&&(this.posts=m.posts,this.postsUpdate.next({posts:[...this.posts],postCount:m.mexPosts}))})}getPostUpdateListener(){return this.postsUpdate.asObservable()}getPost(e){return this.http.get(this.BACKEND_URL+e)}addPost(e,i,n){let m=new FormData;m.append("title",e),m.append("content",i),m.append("image",n,e),this.http.post(this.BACKEND_URL,m).subscribe(()=>{this.router.navigate(["/"])})}updatePost(e,i,n,m){let c;typeof m=="object"?(c=new FormData,c.append("id",e),c.append("title",i),c.append("content",n),c.append("image",m,i)):c={id:e,title:i,content:n,imagePath:m,creator:null},this.http.put(this.BACKEND_URL+e,c).subscribe(()=>{this.router.navigate(["/"])})}deletePost(e){return this.http.delete(this.BACKEND_URL+e)}};t.\u0275fac=function(i){return new(i||t)(C(gt),C(j))},t.\u0275prov=y({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();var le=o=>["/edit",o];function de(o,t){o&1&&h(0,"mat-spinner")}function ue(o,t){if(o&1){let r=M();s(0,"mat-action-row")(1,"a",9),d(2,"EDIT"),a(),s(3,"button",10),S("click",function(){x(r);let i=u().$implicit,n=u(2);return b(n.onDelete(i.id))}),d(4," DELETE "),a()()}if(o&2){let r=u().$implicit;p(),l("routerLink",dt(1,le,r.id))}}function fe(o,t){if(o&1&&(s(0,"mat-expansion-panel",6)(1,"mat-expansion-panel-header"),d(2),a(),s(3,"div",7),h(4,"img",8),a(),s(5,"p"),d(6),a(),_(7,ue,5,3,"mat-action-row",0),a()),o&2){let r=t.$implicit,e=u(2);p(2),lt(" ",r.title," "),p(2),l("src",r.imagePath,R)("alt",r.title),p(2),N(r.content),p(),l("ngIf",e.userIsAuthenticated&&e.userId===r.creator)}}function he(o,t){if(o&1&&(s(0,"mat-accordion",4),_(1,fe,8,5,"mat-expansion-panel",5),a()),o&2){let r=u();p(),l("ngForOf",r.posts)}}function ge(o,t){if(o&1){let r=M();s(0,"mat-paginator",11),S("page",function(i){x(r);let n=u();return b(n.onChangedPage(i))}),a()}if(o&2){let r=u();l("length",r.totalPosts)("pageSize",r.postsPerPage)("pageSizeOptions",r.pageSizeOptions)}}function ve(o,t){o&1&&(s(0,"p",12),d(1,` No posts added yet!
`),a())}var Jt=(()=>{let t=class t{constructor(e,i){this.postsService=e,this.authService=i,this.userIsAuthenticated=!1,this.posts=[],this.isLoading=!1,this.totalPosts=0,this.postsPerPage=2,this.currentPage=1,this.pageSizeOptions=[1,2,5,10]}ngOnInit(){this.isLoading=!0,this.postsService.getPosts(this.postsPerPage,this.currentPage),this.userId=this.authService.getUserId(),this.postSub=this.postsService.getPostUpdateListener().subscribe(e=>{this.posts=e.posts,this.totalPosts=e.postCount,this.isLoading=!1}),this.userIsAuthenticated=this.authService.getIsAuth(),this.authSub=this.authService.getAuthStstusListner().subscribe(e=>{this.userIsAuthenticated=e,this.userId=this.authService.getUserId()})}onDelete(e){this.isLoading=!0,this.postsService.deletePost(e).subscribe(()=>{this.postsService.getPosts(this.postsPerPage,this.currentPage)},()=>{this.isLoading=!1})}onChangedPage(e){console.log(e),this.isLoading=!0,this.currentPage=e.pageIndex+1,this.postsPerPage=e.pageSize,this.postsService.getPosts(this.postsPerPage,this.currentPage)}ngOnDestroy(){this.postSub.unsubscribe(),this.authSub.unsubscribe()}};t.\u0275fac=function(i){return new(i||t)(f(H),f(g))},t.\u0275cmp=P({type:t,selectors:[["app-post-list"]],decls:4,vars:4,consts:[[4,"ngIf"],["multi","true",4,"ngIf"],[3,"length","pageSize","pageSizeOptions","page",4,"ngIf"],["class","info-text mat-body-1",4,"ngIf"],["multi","true"],["style","margin-top: 1rem",4,"ngFor","ngForOf"],[2,"margin-top","1rem"],[1,"post-image"],[3,"src","alt"],["mat-button","","color","primary",3,"routerLink"],["mat-button","","color","warn",3,"click"],[3,"page","length","pageSize","pageSizeOptions"],[1,"info-text","mat-body-1"]],template:function(i,n){i&1&&_(0,de,1,0,"mat-spinner",0)(1,he,2,1,"mat-accordion",1)(2,ge,1,3,"mat-paginator",2)(3,ve,2,0,"p",3),i&2&&(l("ngIf",n.isLoading),p(),l("ngIf",n.posts.length>0&&!n.isLoading),p(),l("ngIf",n.posts.length>0),p(),l("ngIf",n.posts.length<=0&&!n.isLoading))},dependencies:[ft,E,U,I,Dt,Ft,Rt,Nt,B,Ut,V],styles:["[_nghost-%COMP%]{display:block;margin-top:1rem}.info-text[_ngcontent-%COMP%]{text-align:center}mat-spinner[_ngcontent-%COMP%]{margin:auto}.post-image[_ngcontent-%COMP%]{width:100%}img[_ngcontent-%COMP%]{width:100%;box-shadow:1px 1px 5px #00000080}"]});let o=t;return o})();var Qt=o=>{if(typeof o.value=="string")return Z(null);let t=o.value,r=new FileReader;return X.create(i=>{r.addEventListener("loadend",()=>{let n=new Uint8Array(r.result).subarray(0,4),m="",c=!1;for(let L=0;L<n.length;L++)m+=n[L].toString(16);switch(m){case"89504e47":c=!0;break;case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":case"ffd8ffe3":case"ffd8ffe8":c=!0;break;default:c=!1;break}c?i.next(null):i.next({invalidMimeType:!0}),i.complete()}),r.readAsArrayBuffer(t)})};function _e(o,t){o&1&&h(0,"mat-spinner")}function ye(o,t){o&1&&(s(0,"mat-error"),d(1,"Pleas enter a post title"),a())}function Ce(o,t){if(o&1&&(s(0,"div",10),h(1,"img",11),a()),o&2){let r=u(2);p(),l("src",r.imagePreview,R)("alt",r.form.value.title)}}function Pe(o,t){o&1&&(s(0,"mat-error"),d(1,"Pleas enter a post content"),a())}function xe(o,t){if(o&1){let r=M();s(0,"form",3),S("submit",function(){x(r);let i=u();return b(i.onSavePost())}),s(1,"mat-form-field"),h(2,"input",4),_(3,ye,2,0,"mat-error",1),a(),_(4,Ce,2,2,"div",5),s(5,"mat-form-field"),h(6,"textarea",6),_(7,Pe,2,0,"mat-error",1),a(),s(8,"button",7),d(9,"Save Post"),a(),s(10,"button",8),S("click",function(){x(r);let i=ct(13);return b(i.click())}),d(11," Add Image "),a(),s(12,"input",9,0),S("change",function(i){x(r);let n=u();return b(n.onImagePicked(i))}),a()()}if(o&2){let r=u();l("formGroup",r.form),p(3),l("ngIf",r.form.get("title").invalid),p(),l("ngIf",r.imagePreview!==""&&r.imagePreview&&r.form.get("image").valid),p(3),l("ngIf",r.form.get("content").invalid)}}var W=(()=>{let t=class t{constructor(e,i,n){this.authService=e,this.postService=i,this.route=n,this.editMode=!1,this.isLoading=!1}ngOnInit(){this.authStatusSub=this.authService.getAuthStstusListner().subscribe(()=>this.isLoading=!1),this.form=new St({title:new D(null,{validators:[O.required,O.minLength(3)]}),content:new D(null,{validators:[O.required]}),image:new D(null,{validators:[O.required],asyncValidators:[Qt]})}),this.route.paramMap.subscribe(e=>{e.has("postId")?(this.editMode=!0,this.postId=e.get("postId"),this.isLoading=!0,this.postService.getPost(this.postId).subscribe(i=>{this.isLoading=!1,this.post={id:i._id,title:i.title,content:i.content,imagePath:i.imagePath,creator:i.creator},this.form.setValue({title:this.post.title,content:this.post.content,image:this.post.imagePath})})):(this.editMode=!1,this.postId=null)})}onImagePicked(e){let i=e.target.files[0];this.form.patchValue({image:i}),this.form.get("image").updateValueAndValidity();let n=new FileReader;n.onload=()=>{this.imagePreview=n.result},n.readAsDataURL(i)}onSavePost(){this.form.invalid||(this.isLoading=!0,this.editMode?this.postService.updatePost(this.postId,this.form.value.title,this.form.value.content,this.form.value.image):this.postService.addPost(this.form.value.title,this.form.value.content,this.form.value.image),this.form.reset())}ngOnDestroy(){this.authStatusSub.unsubscribe()}};t.\u0275fac=function(i){return new(i||t)(f(g),f(H),f(Lt))},t.\u0275cmp=P({type:t,selectors:[["app-post-create"]],decls:3,vars:2,consts:[["filePicker",""],[4,"ngIf"],[3,"formGroup","submit",4,"ngIf"],[3,"submit","formGroup"],["matInput","","type","text","formControlName","title","placeholder","Post Title"],["class","image-preview",4,"ngIf"],["matInput","","rows","5","formControlName","content","placeholder","Post Content"],["mat-raised-button","","color","primary","type","submit"],["mat-stroked-button","","color","primary","type","button",2,"margin-left","10px",3,"click"],["type","file",3,"change"],[1,"image-preview"],[3,"src","alt"]],template:function(i,n){i&1&&(s(0,"mat-card"),_(1,_e,1,0,"mat-spinner",1)(2,xe,14,4,"form",2),a()),i&2&&(p(),l("ngIf",n.isLoading),p(),l("ngIf",!n.isLoading))},dependencies:[E,It,Pt,xt,bt,Mt,wt,Bt,Vt,jt,zt,I,B],styles:["form[_ngcontent-%COMP%]{padding:1rem}mat-form-field[_ngcontent-%COMP%]{width:100%}mat-spinner[_ngcontent-%COMP%]{margin:auto}input[type=file][_ngcontent-%COMP%]{visibility:hidden}.image-preview[_ngcontent-%COMP%]{height:10rem;margin:0 0 1rem}.image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%}"]});let o=t;return o})();var G=(()=>{let t=class t{constructor(e,i){this.authService=e,this.router=i}canActivate(e,i){let n=this.authService.getIsAuth();return n||this.router.navigate(["/auth/login"]),n}};t.\u0275fac=function(i){return new(i||t)(C(g),C(j))},t.\u0275prov=y({token:t,factory:t.\u0275fac});let o=t;return o})();var be=[{path:"",component:Jt},{path:"create",component:W,canActivate:[G]},{path:"edit/:postId",component:W,canActivate:[G]},{path:"auth",loadChildren:()=>import("./chunk-UHF2KBG2.js").then(o=>o.AuthModule)}],te=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=A({type:t}),t.\u0275inj=w({providers:[G],imports:[T.forRoot(be),T]});let o=t;return o})();var ee=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=A({type:t}),t.\u0275inj=w({imports:[ht,Et,z,T]});let o=t;return o})();function Se(o,t){o&1&&(s(0,"li")(1,"a",4),d(2,"New Post"),a()())}function Ie(o,t){o&1&&(s(0,"li")(1,"a",5),d(2,"Login"),a()())}function Me(o,t){o&1&&(s(0,"li")(1,"a",6),d(2,"Signup"),a()())}function we(o,t){if(o&1){let r=M();s(0,"li")(1,"button",7),S("click",function(){x(r);let i=u();return b(i.onLogout())}),d(2,"Logout"),a()()}}var ie=(()=>{let t=class t{constructor(e){this.authService=e,this.userIsAuthenticated=!1}ngOnInit(){this.userIsAuthenticated=this.authService.getIsAuth(),this.authSubs=this.authService.getAuthStstusListner().subscribe(e=>{this.userIsAuthenticated=e})}onLogout(){this.authService.logout()}ngOnDestroy(){this.authSubs.unsubscribe()}};t.\u0275fac=function(i){return new(i||t)(f(g))},t.\u0275cmp=P({type:t,selectors:[["app-header"]],decls:10,vars:4,consts:[["color","primary"],["routerLink","/"],[1,"spacer"],[4,"ngIf"],["mat-button","","routerLink","/create","routerLinkActive",""],["mat-button","","routerLink","/auth/login","routerLinkActive",""],["mat-button","","routerLink","/auth/signup","routerLinkActive",""],["mat-button","",3,"click"]],template:function(i,n){i&1&&(s(0,"mat-toolbar",0)(1,"span")(2,"a",1),d(3," MyMessage"),a()(),h(4,"span",2),s(5,"ul"),_(6,Se,3,0,"li",3)(7,Ie,3,0,"li",3)(8,Me,3,0,"li",3)(9,we,3,0,"li",3),a()()),i&2&&(p(6),l("ngIf",n.userIsAuthenticated),p(),l("ngIf",!n.userIsAuthenticated),p(),l("ngIf",!n.userIsAuthenticated),p(),l("ngIf",n.userIsAuthenticated))},dependencies:[E,V,Tt,U,I,Ht],styles:["ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}a[_ngcontent-%COMP%]{text-decoration:none;color:#fff}ul[_ngcontent-%COMP%]{display:flex}.spacer[_ngcontent-%COMP%]{flex:1 1 auto}"]});let o=t;return o})();var oe=(()=>{let t=class t{constructor(e){this.authService=e}ngOnInit(){this.authService.autoAuthUser()}};t.\u0275fac=function(i){return new(i||t)(f(g))},t.\u0275cmp=P({type:t,selectors:[["app-root"]],decls:3,vars:0,template:function(i,n){i&1&&(h(0,"app-header"),s(1,"main"),h(2,"router-outlet"),a())},dependencies:[Ot,ie],styles:["main[_ngcontent-%COMP%]{width:80%;margin:1rem auto}"]});let o=t;return o})();var re=(()=>{let t=class t{constructor(e){this.data=e}};t.\u0275fac=function(i){return new(i||t)(f(Gt))},t.\u0275cmp=P({type:t,selectors:[["ng-component"]],decls:8,vars:1,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"mat-body-1"],["mat-button","","mat-dialog-close",""]],template:function(i,n){i&1&&(s(0,"h1",0),d(1,"An Error Occured"),a(),s(2,"div",1)(3,"p",2),d(4),a()(),s(5,"div",1)(6,"button",3),d(7,"OK"),a()()),i&2&&(p(4),N(n.data.message))},dependencies:[I,$t,qt,Wt],encapsulation:2});let o=t;return o})();var ne=(()=>{let t=class t{constructor(e){this.authServive=e}intercept(e,i){let n=this.authServive.getToken(),m=e.clone({headers:e.headers.set("authorization","Bearer "+n)});return i.handle(m)}};t.\u0275fac=function(i){return new(i||t)(C(g))},t.\u0275prov=y({token:t,factory:t.\u0275fac});let o=t;return o})();var se=(()=>{let t=class t{constructor(e){this.dialog=e}intercept(e,i){return i.handle(e).pipe(tt(n=>{let m="An unknown error occured!";return n.error.message&&(m=n.error.message),this.dialog.open(re,{data:{message:m}}),J(n)}))}};t.\u0275fac=function(i){return new(i||t)(C(Kt))},t.\u0275prov=y({token:t,factory:t.\u0275fac});let o=t;return o})();var ae=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=A({type:t,bootstrap:[oe]}),t.\u0275inj=w({providers:[Xt(),{provide:K,useClass:ne,multi:!0},{provide:K,useClass:se,multi:!0}],imports:[Ct,te,At,vt,z,ee]});let o=t;return o})();yt().bootstrapModule(ae).catch(o=>console.error(o));
